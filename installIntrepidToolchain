#!/bin/bash
# this allows the toolchain to be setup and placed in 
#   the project folder, no sudo required
# sourced from the cmake wiki, located at the following URL
#   as of this writing on 3/17/17
# https://cmake.org/Wiki/CMake_Cross_Compiling
# by Mark Hill

CUR_DIR=$(pwd)
# the location where cmake places the build files
#   which will also be used for the toolchain
#   since the toolchain can be removed and updated
#   by deleting the build directory
BUILD_DIR=$CUR_DIR/build

# the location to which the repo with the toolchain
#   will be cloned
TOOLCHAIN_DEST_DIR=$BUILD_DIR/toolchain

# build tool location (for the gcc, g++, ld, etc. programs)
BUILD_TOOL_DIR=$TOOLCHAIN_DEST_DIR/bin

# the location of the repo containing the cross compile
#   toolchain
TOOLCHAIN_REPO=https://github.com/irvinecubesat/toolchain-arm-linux.git

# the location of the cmake config file generated by
#   this script to point cmake to the cross compile toolchain
CMAKE_TOOLCHAIN_FILE=$BUILD_DIR/toolchainIntrepidR8.cmake

# make the toolchain file variable visible to the makefile
#   so that this script is the single location for setting
#   the toolchain
export CMAKE_TOOLCHAIN_FILE="$CMAKE_TOOLCHAIN_FILE"

# if the toolchain has not already been setup, do so
#   else return since no work needs to be done
if [ ! -e $CMAKE_TOOLCHAIN_FILE ]; then
	# make the parent directory
	mkdir -p $TOOLCHAIN_DEST_DIR 
	# clone the repo from the source into the destination
	#   specified by the variables above
	git clone $TOOLCHAIN_REPO $TOOLCHAIN_DEST_DIR
	
	# now write to the toolchain file all the settings
	#  as recommended by the cmake wiki
	printf "\
#Generated by installIntrepidToolchain \n\
\n\
SET(CMAKE_SYSTEM_NAME Linux) \n\
SET(CMAKE_SYSTEM_VERSION 1) \n\
\n\
SET(CMAKE_C_COMPILER $BUILD_TOOL_DIR/arm-linux-gcc) \n\
SET(CMAKE_FIND_ROOT_PATH $BUILD_TOOL_DIR) \n\
\n\
SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER) \n\
SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY) \n\
SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY) \n\
	\n" > $CMAKE_TOOLCHAIN_FILE



fi


